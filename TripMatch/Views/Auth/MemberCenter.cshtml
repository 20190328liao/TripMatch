@{
    ViewData["Title"] = "會員中心";
    Layout = "~/Views/Shared/_LoginLayout.cshtml";

    var avatarUrl = User.FindFirst("Avatar")?.Value;
    if (string.IsNullOrEmpty(avatarUrl))
    {
        avatarUrl = Url.Content("~/img/default_avatar.png");
    }
}

<div class="member_center_wrap">

    <!-- =============================================
         區塊一：個人資料
         ============================================= -->
    <section class="member_section" id="profile_section">
        <h2 class="titleWrap titleH2">個人資料</h2>

        <!-- 通知列 -->
        <div class="notification_bar">
            <i class="bi bi-bell"></i>
        </div>

        <div class="profile_container">
            <!-- 左側：頭像區 -->
            <div class="profile_avatar_section ">
                <div class="avatar_frame">
                    @* ★ 使用從 Claims 取得的頭像 URL *@
                    <img src="@avatarUrl" alt="會員頭像" id="memberAvatar" class="memberAvatar">
                </div>
                <input type="file" id="avatarInput" accept="image/jpeg,image/png,image/gif,image/webp" style="display: none;">
                <button type="button" class="btn btn_light  btn-sm mt-2" id="btnEditAvatar">編輯頭像</button>
                <button type="button" class="btn btn_Gray btn-sm mt-2" id="btnLogout">登 出</button>
            </div>

            <!-- 右側：資料區 -->
            <div class="profile_info_section">
                <div class="info_row">
                    <div class="info_item">
                        <label class="info_label"><i class="bi bi-square-fill text-success me-2"></i>帳號｜電子郵件</label>
                        <div class="info_value">
                            <span id="displayEmail">example@gmail.com</span>


                            @*編輯電子郵件*@
                            <input id="inputEmail" type="email" name="name" value="" class="form-control d-none" />
                            <button id="btnEditEmail" class="btn btn_link edit_link">編輯</button>
                            <button id="btnSaveEmail" class="btn btn_light btn-sm d-none">寄驗證信</button>
                            <button id="btnCancelEmail" class="btn btn_light btn-sm d-none">取消</button>
                        </div>
                    </div>
                </div>
                <div class="info_row">
                    <div class="info_item">
                        <label class="info_label"><i class="bi bi-square-fill text-warning me-2"></i>備援信箱</label>
                        <div class="info_value">
                            <span id="displayBackupEmail">example2@gmail.com</span>

                            @*編輯電子郵件*@
                            <input id="inputBackupEmail" type="email" name="name" value="" class="form-control d-none" />
                            <button id="btnEditBackupEmail" class="btn btn_link edit_link">編輯</button>
                            <button id="btnSaveBackupEmail" class="btn btn_light btn-sm d-none">寄驗證信</button>
                            <button id="btnCancelBackupEmail" class="btn btn_light btn-sm d-none">取消</button>
                        </div>
                    </div>
                    <div class="info_item">
                        <label class="info_label"><i class="bi bi-square-fill text-warning me-2"></i>重設密碼</label>
                        <a href="@Url.Action("ChangePassword", "Auth")" class="edit_link">前往重設</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- =============================================
         區塊二：個人行事曆
         ============================================= -->
    <section class="member_section" id="calendar_section">
        <h2 class="titleWrap titleH2">媒合行事曆</h2>

        <div class="container two-column">
            <div class="months-panel">
                <header class="year-header">
                    <button class="year-left">◀</button>
                    <div class="year-display">2026</div>
                    <button class="year-right">▶</button>
                </header>

                <div class="months-grid"></div>
            </div>

            <div class="month-panel">
                <header class="month-header">
                    <button class="month-left">◀</button>
                    <div class="month-display">January 2026</div>
                    <button class="month-right">▶</button>
                </header>

                <div class="week">
                    <div>週一</div>
                    <div>週二</div>
                    <div>週三</div>
                    <div>週四</div>
                    <div>週五</div>
                    <div>週六</div>
                    <div>週日</div>
                </div>

                <div class="days"></div>

                <div class="display-selected">
                    <p class="selected"></p>
                </div>
            </div>
        </div>
        <button class="single-select">單選</button>
        <button class="multi-select">多選</button>
        <button class="confirm">確定</button>
        <button class="edit">編輯</button>
    </section>

    <!-- =============================================
         區塊三：願望清單
         ============================================= -->
    <section class="member_section" id="wishlist_section">
        <div class="section_header">
            <h2 class="titleWrap titleH2">願望清單</h2>
            <a href="#" class="edit_cards_link"><i class="bi bi-pencil-square me-1"></i>點擊卡片編輯 ▼</a>
        </div>

        <!-- 願望清單卡片 -->
        <div class="wishlist_cards_container" id="wishlistCardsContainer">
            <div class="wish_card">
                <div class="card_image">
                    <img src="~/img/Logo/Part12.png" alt="台灣九份之旅">
                    <button type="button" class="wish_heart active"><i class="bi bi-heart-fill"></i></button>
                </div>
                <div class="card_content">
                    <h4 class="card_title"></h4>
                    <p class="card_date"></p>
                    <div class="card_footer">
                        <span class="travelers"></span>
                        <span class="price highlight"></span>
                    </div>
                </div>
            </div>

        </div>

        <div class="view_more_wrap">
            <a href="#" class="view_more_link">View more...</a>
        </div>
    </section>

</div>
<a href="@Url.Action("Index", "Home")" class="back-home-link">
    回到首頁
</a>

@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

    <!-- 先載入 helper.js（提供 Validator / setFieldHint / AppUrls） -->
    <script src="~/js/AuthApi/helper.js"></script>
    <script src="~/js/AuthApi/Calendar.js"></script>
    <!-- 載入並執行 memberCenter.js（包含 month-picker + calendar 整合） -->
    <script src="~/js/AuthApi/memberCenter.js"></script>
    <script src="~/js/AuthApi/logout.js"></script>
}

