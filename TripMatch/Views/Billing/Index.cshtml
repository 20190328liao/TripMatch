@using System.Linq
@model IEnumerable<TripMatch.Models.Trip>
@{
    // Layout = null;
    Layout = "~/Views/Shared/_Layout-copy.cshtml";
    ViewData["Title"] = "旅程記帳列表";
}

@section Styles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="~/css/Billing/accounting.css" asp-append-version="true">
}

    <div class="container">
        <header class="page-header">
            <h1 class="page-title">旅程記帳分帳列表</h1>
            <button class="btn-create" onclick="createNewTrip()">
                <i class="fa-solid fa-plus"></i> 建立新旅程
            </button>
        </header>

        @* <div class="trip-grid" id="tripList">
            <div class="trip-card" onclick="goToTrip('trip1')">
                <div class="trip-info">
                    <h3>台南兩日遊美食行程</h3>
                    <div class="trip-meta">
                        <span><i class="fa-regular fa-calendar"></i> 上次更新：2026/1/19 1:10 下午</span>
                        <span><i class="fa-solid fa-user-group"></i> 3 人</span>
                    </div>
                </div>
                <div class="trip-action">
                    <span class="status-badge">進行中</span>
                    <i class="fa-solid fa-chevron-right arrow-icon"></i>
                </div>
            </div>

            <div class="trip-card" onclick="goToTrip('trip2')">
                <div class="trip-info">
                    <h3>日本東京五天四夜</h3>
                    <div class="trip-meta">
                        <span><i class="fa-regular fa-calendar"></i> 上次更新：2025/12/25</span>
                        <span><i class="fa-solid fa-user-group"></i> 4 人</span>
                    </div>
                </div>
                <div class="trip-action">
                    <span class="status-badge">已結算</span>
                    <i class="fa-solid fa-chevron-right arrow-icon"></i>
                </div>
            </div>
        </div> *@

        <div class="trip-grid" id="tripList">

            @* --- 使用 foreach 迴圈讀取資料庫 --- *@
            @foreach (var item in Model)
            {
                <div class="trip-card" onclick="goToTrip('@item.Id')">
                    <div class="trip-info">

                        <h3>@item.Title</h3>

                        <div class="trip-meta">
                            <span>
                                <i class="fa-regular fa-calendar"></i>
                                @item.StartDate.ToString("yyyy/MM/dd") - @item.EndDate.ToString("yyyy/MM/dd")
                            </span>

                            <span>
                                <i class="fa-solid fa-user-group"></i>
                                @(item.TripMembers != null ? item.TripMembers.Count : 0) 人
                            </span>
                        </div>
                    </div>

                    <div class="trip-action">
                        @if (item.EndDate < DateOnly.FromDateTime(DateTime.Now))
                        {
                            <span class="status-badge" style="background:#f1f5f9; color:#64748b; border-color:#e2e8f0;">已結束</span>
                        }
                        else
                        {
                            <span class="status-badge">進行中</span>
                        }
                        <i class="fa-solid fa-chevron-right arrow-icon"></i>
                    </div>
                </div>
            }

            @* 若資料庫完全沒資料，顯示提示 *@
            @if (!Model.Any())
            {
                <div style="text-align:center; color:#999; margin-top:20px;">
                    目前還沒有任何旅程，點擊右上角建立一個吧！
                </div>
            }

        </div>
    </div>

    @section Scripts {
        <script src="~/js/Billing/accounting.js" asp-append-version="true"></script>
    }
