@page
@model TripMatch.Controllers.AuthApiController
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery
@{
    var tokens = Antiforgery.GetAndStoreTokens(HttpContext);
    ViewData["Title"] = "登入";
    Layout = "~/Views/Shared/_LayoutAuth.cshtml"; 
}

<div class="signWrap">
    <div class="container-fluid p-0">
        <div class="row g-0 min-vh-100">
            <div class="signContent s1 col-12 col-md-6">
                廣告區
            </div>

            <div class="signContent s2 col-12 col-md-6">
                <div class="mb-4">
                    @* 使用 Url.Action 跳轉到註冊頁 *@
                    <a href="@Url.Action("Login", "AuthApi")" class="titleWrap titleH1" style="border-bottom: 3px solid black; text-decoration:none; color:inherit;">登入</a>
                    <a href="@Url.Action("Signup", "AuthApi")" class="titleWrap titleH1" style="text-decoration:none; color:inherit; margin-left:10px;">註冊</a>
                </div>

                <form id="loginForm">
                    @* CSRF Token 隱藏欄位 *@
                    <input type="hidden" name="__RequestVerificationToken" value="@tokens.RequestToken" />

                    <div class="formWrap">
                        <label class="titleWrap titleH3 d-block">帳號 (電子郵件)</label>
                        <input id="email" name="email" class="input1 psw" type="email" placeholder="example@gmail.com">
                        <div id="emailHint" class="inputHint"></div>
                    </div>

                    <div class="formWrap">
                        <label class="titleWrap titleH3 d-block">密碼 *</label>
                        <input type="password" id="password" name="password" class="input1 psw" placeholder="6 到 18 位數密碼和大小寫英文">
                        <div id="pwdHint" class="inputHint"></div>
                    </div>

                    <div class="mt-4 text-center">
                        <div class="lineBlack"></div>
                        @* 外部登入路徑保持指向 API *@
                        <a href="/api/auth/login-google" class="google-btn">
                            <img src="~/img/googleBtn.png" alt="Google 登入" style="width: 200px; cursor: pointer;">
                        </a>
                    </div>

                    <div id="systemMessage" class="mt-3 p-2 d-none"></div>
                    <p class="privacy">* 登入即表示您同意隱私權政策。</p>

                    <button type="button" class="btn btn_Gray confirmCheck eLabel mt-4" id="btnLogin" disabled>登入</button>
                </form>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        // 將 Anti-Forgery Token 存入全域供 AJAX 使用
        window.csrfToken = "@tokens.RequestToken";
    </script>
    <script src="~/js/helper.js"></script>
    <script src="~/js/signup.js"></script>
    @if (TempData["RegSuccess"]?.ToString() == "true")
    {
        <script>
            $(function() {
                showPopup({
                    title: "註冊成功",
                    message: "歡迎加入！現在可以開始登入了。",
                    type: "success",
                    autoClose: true,
                    seconds: 5
                });
            });
        </script>
    }
}
